@startuml

Service <|-- TransactionService
TransactionBackend <|-- PostgreSQLBackend
Callback <|-- PostgreSQLPumpCallback
PostgreSQLPumpCallback -- PostgreSQLBackend
TransactionService *-- TransactionBackend : backends
TransactionService *-- Callback : message_callbacks

class Service {
	+ {abstract} handle_message(connection_message, connection)
}

class TransactionService {
	+ TransactionService(address_to_listen)
	+ handle_message(connection_message, connection)
	+ add_transaction_backend(transaction_backend)
	+ clear_transaction_backends()
	+ run()
	+ stop()
	- network_service
	- add_callback(callback)
	- clear_callbacks()
}

class TransactionBackend {
	+ {abstract} create_callback() : Callback
}

class PostgreSQLBackend {
	+ PostgreSQLBackend(db_connection_info)
	+ create_callback() : Callback
	- db_connection
}

class Callback {
	+ execute(connection_message)
	~ {abstract} handle_message(connection_message, connection)
	- message_type
}

class PostgreSQLPumpCallback {
	+ PostgreSQLPumpCallback(db_connection_info)
	~ handle_message(connection_message)
	- db_connection
	- store_node(connection_message)
	- insert_node(hwid, swid, inid)
	- insert_hwdesc(hwdesc)
	- insert_swdesc(swdesc)
	- insert_indesc(indesc)
	- store_activity(connection_message)
	- insert_activity(connection_message)
}

@enduml
