@startuml


package Ontology <<frame>> {
	object Attribute #yellow {
		attributeID : int4 key auto-increment
		domain : text
		name : text		
		storage_type : smallint
		<domain, name> : unique
		
		'meta : int4[] (attributeID, value) stored as array, alternative 
		'values: 
	}

	object MetaAttributeInt32 #yellow {
		forID : int4 foreign-key
		attribute : int4 foreign-key
		value: int4
	}

	object MetaAttributeInt64 #yellow {
		forID : int4 foreign-key
		attribute : int4 foreign-key
		value: int8
	}

	object MetaAttributeFloatDouble #yellow {
		forID : int4 foreign-key
		attribute : int4 foreign-key
		value: int8
	}

	object MetaAttributeStr #yellow {
		forID : int4 foreign-key
		attribute : int4 foreign-key
		value: text
	}

	MetaAttributeInt32 -- Attribute
	MetaAttributeInt64 -- Attribute
	MetaAttributeFloatDouble -- Attribute
	MetaAttributeStr -- Attribute

	note right of Attribute
		Access to the meta attributes is performant
		because we know the type of the meta-attr.
		Enumeration comes with a cost.
	end note
}


package Activities <<frame>> {

	object ActivityID{
		id : int8 key auto-increment

		thread : int4 not null
		id : int4 not null
		
		cid_pid_nid : int4 not null
		cid_pid_pid : int4 not null
		cid_pid_time : int4 not null		
		cid_id : int4 not null
	}

	object RemoteCallIdentifier{
' 		RemoteCallIdentifier
'		NodeID nid; // optional
'		UniqueInterfaceID uuid; // optional
'		AssociateID instance; // optional, remote call instance identifier		
		id : int8 key auto-increment

		nid : int4 nullable
		ucaid : int4 nullable
		instance : text nullable
	}

	object RemoteCall{
'	typedef struct {
'		RemoteCallIdentifier target;
'		vector<Attribute> attributes;
'	} RemoteCall;	
		id : int8 key auto-increment

		rcID : int8 foreign-key

		attributes : attribute[] TODO
	}

	object Activity {
		id : int8 key auto-increment
		ucaid : int4 not null
		time_start : int8 not null
		time_stop : int8

		parents : int8[] foreign-key

'	typedef struct {
'		RemoteCallIdentifier target;
'		vector<Attribute> attributes;
'	} RemoteCall;
		remoteCalls : int8[] foreign-key

'		OntologyAttributeID id;
'		AttributeValue value;		
		attributes : attribute[] TODO

		remoteCallInvoker : int8 nullable foreign-key

		error_value : int4
	}

	Activity -- ActivityID
	Activity -- RemoteCallIdentifier
	Activity -- RemoteCall
	RemoteCallIdentifier -- RemoteCall


	Activity -- Attribute 
}

package SystemInformationGlobalIDManager <<frame>> {
	object NodeMapping #gold {
		NodeID : int4 key auto-increment
		Hostname: text unique
	}

	object DeviceMapping #gold {
		DeviceID : int4 key auto-increment
		UniqueIdentifier: text
		NodeID: int4 foreign key
		<NodeID, UniqueIdentifier> : unique
	}

	DeviceMapping -- NodeMapping

	object FilesystemMapping #gold {
		FilesystemID : int4 key auto-increment
		UniqueIdentifier: text unique
	}

	object UniqueInterfaceMapping #gold {
		UniqueInterfaceID : int4 key auto-increment
		Interface: text
		Implementation: text
		<Interface, Implementation> : unique
	}

	object ComponentActivityMapping #gold {
		ActivityID : int4 key auto-increment
		UniqueInterfaceID: int4 key foreign-key		
		Name: text
	}

	ComponentActivityMapping -- UniqueInterfaceMapping
	RemoteCallIdentifier -- UniqueInterfaceMapping
	Activity -- ComponentActivityMapping
	NodeMapping -- ActivityID
	NodeMapping -- RemoteCallIdentifier
}

package AssocationMapper <<frame>> {

	object InstanceMapping #coral {
		id : int4
		value: text unique
	}

	object ComponentAttributesInt3264 #coral {
		component : int4 foreign-key
		attribute : int4 foreign-key
		value: int8
	}

	object ComponentAttributesStr #coral {
		component : int4 foreign-key
		attribute : int4 foreign-key
		value: text
	}


	object ProcessAttributesInt3264 #coral {
		component : int4 foreign-key
		attribute : int4 foreign-key
		value: int8
	}

	object ProcessAttributesStr #coral {
		component : int4 foreign-key
		attribute : int4 foreign-key
		value: text
	}

	Attribute -- ProcessAttributesStr
	Attribute -- ProcessAttributesInt3264
	Attribute -- ComponentAttributesStr
	Attribute -- ComponentAttributesInt3264
}

package Statistics <<frame>> {
}

package KnowledgeBase <<frame>> {
	package SystemInformation <<frame>> {
	}

	package <PluginSpecific>Pattern <<frame>> {
	}

	package <PluginSpecific>Information <<frame>> {
	}	
}


@enduml
